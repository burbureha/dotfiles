"use strict";(self.webpackChunktoby=self.webpackChunktoby||[]).push([[606],{34814:(e,t,n)=>{n.d(t,{c:()=>a});var r=n(32119),a=function(e){return{type:r.rX,payload:e}}},35505:(e,t,n)=>{n.d(t,{th:()=>u,RD:()=>o,Bl:()=>d,tq:()=>b});var r=n(92137),a=n(87757),s=n.n(a),c=n(55338),i=n(34814);function u(){var e=localStorage.getItem("open_toby_params");if(e){var t=b(e);return t.token&&t}}function o(e,t){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.GH)("me",n.token);case 2:return(r=e.sent).token=n.token,t.changeUser(r),null!=r&&r.config&&t.updateConfig(null==r?void 0:r.config),t.getState(),localStorage.removeItem("open_toby_params"),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,t){return l.apply(this,arguments)}function l(){return(l=(0,r.Z)(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=localStorage.getItem("open_toby_params"))&&(f(t,n,r),localStorage.removeItem("open_toby_params"));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t,n){return h.apply(this,arguments)}function h(){return(h=(0,r.Z)(s().mark((function e(t,n,r){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:(a=b(r)).team_id&&a.space_id&&a.collection_id?(n.dispatch((0,i.c)("SPACE")),t.selectTeam(a.team_id)(n.dispatch),t.selectGroup(a.team_id,a.space_id)(n.dispatch),t.selectList(a.collection_id)(n.dispatch)):a.team_id&&a.space_id?(n.dispatch((0,i.c)("SPACE")),t.selectTeam(a.team_id)(n.dispatch),t.selectGroup(a.team_id,a.space_id)(n.dispatch)):a.team_id&&t.selectTeam(a.team_id)(n.dispatch);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){for(var t=new URLSearchParams(e),n={},r=0,a=Array.from(t.entries());r<a.length;r++){var s=a[r];n[s[0]]=s[1]}return n}},16606:(e,t,n)=>{n.r(t),n.d(t,{initConsumer:()=>T,updateStateDebounced:()=>ye});var r=n(96156),a=n(87329),s=n(92137),c=n(87757),i=n.n(c),u=n(76613),o=function(e){return JSON.parse(decodeURIComponent(atob(e)))},p=n(42384),d=n(96486),l=n(11891),f=n(69132),h=n(55310),b=n(35505),y=n(10693),g=n(32119),v=n(15970),w=n(26770),m=n(88795),x=n(37949),k=n(64073);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=!1,Z=!1,I=null,q=m.OQ,_=new Set;_.add(g.S$),_.add(g.PG);var E=new Set;E.add(g.BQ),E.add(g.py);var L,P=v.xh.filter((function(e){return e.show===w._5})).map((function(e){return e.name}));function T(e){I=e,f.U2("lastState",(function(e){O=e})),f.U2("isSyncedData",(function(e){Z=e})),function(){C.apply(this,arguments)}()}function j(e){O=e,f.t8("lastState",O)}function A(e){Z=e,f.t8("isSyncedData",Z)}function C(){return(C=(0,s.Z)(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:return e.prev=2,e.next=5,(0,p.Z)(100*Math.min(t,100));case 5:return e.next=7,U();case 7:return e.next=9,D();case 9:return e.next=11,F();case 11:return n=e.sent,r=n?100:0,e.next=15,(0,p.Z)(r);case 15:t=0,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),t++,console.warn(e.t0);case 22:e.next=1;break;case 24:case"end":return e.stop()}}),e,null,[[2,18]])})))).apply(this,arguments)}function D(){return G.apply(this,arguments)}function G(){return(G=(0,s.Z)(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.Z.length){e.next=2;break}return e.abrupt("return");case 2:t=u.Z.dequeue(),n=t.action,e.t0=n.type,e.next=e.t0===g.Nv?6:8;break;case 6:return ae(),e.abrupt("break",10);case 8:return console.warn("no handler for bgQueue action type ".concat(n.type)),e.abrupt("break",10);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return B.apply(this,arguments)}function B(){return(B=(0,s.Z)(i().mark((function e(){var t,n,r,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:t=e.sent,(n=y.zG.peek(t.getState())).req,r=n.reqId,a=n.retryCount,n.isDisplayDialog,s=Math.pow(2,Math.min(a,6))-1,r===L&&0===a&&(s=10),c=0;case 8:if(!(c<s)){e.next=19;break}if(!((u=y.zG.peek(t.getState())).reqId!==n.reqId||u.retryCount<n.retryCount)){e.next=14;break}return console.log("queue has changed while in backoff, returning new item"),e.abrupt("return",u);case 14:return e.next=16,(0,p.Z)(1e3);case 16:c++,e.next=8;break;case 19:return L=r,e.abrupt("return",n);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return z.apply(this,arguments)}function z(){return(z=(0,s.Z)(i().mark((function e(){var t,n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:return t=e.sent,n=y.zG.length(t.getState()),r=y.Z8.internet(t.getState()),a=y.Z8.isSessionExpired(t.getState()),e.abrupt("return",!n||!r||a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=0;function U(){return Q.apply(this,arguments)}function Q(){return(Q=(0,s.Z)(i().mark((function e(){var t,n,r,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:return t=e.sent,e.next=5,F();case 5:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:return he(),e.next=11,N();case 11:if(n=e.sent,r=n.req,a=n.reqId,s=n.retryCount,e.prev=13,!(M>20)){e.next=19;break}return e.next=17,(0,p.Z)(6e4);case 17:return e.next=19,ce();case 19:return e.next=21,W(r);case 21:t.dispatch(h.pendingReqRemoveById(a)),t.dispatch(h.pendingReqResetTime()),M=0,e.next=37;break;case 26:if(e.prev=26,e.t0=e.catch(13),console.log(e.t0),401!==e.t0.status){e.next=34;break}return M++,console.warn("401. Session expired!"),t.dispatch(h.sessionExpired()),e.abrupt("return");case 34:M=0,c=e.t0.status>=400&&e.t0.status<500,_.has(r.type)?(t.dispatch(h.pendingReqRemoveById(a)),t.dispatch(h.pendingReqResetTime()),console.warn("Dropping a fast-fail request of type ".concat(r.type))):c&&!E.has(r.type)&&s>=2?(t.dispatch(h.pendingReqRemoveById(a)),t.dispatch(h.pendingReqResetTime()),console.warn("Dropping a 4XX request of type ".concat(r.type))):(u=!q.has(e.t0.status)&&s>=6,t.dispatch(h.pendingReqRetryById(a,{isDisplayDialog:u,lastError:e.t0.status})),console.warn("Req failed will retry (".concat(s+1,"); isDisplayDialog ").concat(u)));case 37:case"end":return e.stop()}}),e,null,[[13,26]])})))).apply(this,arguments)}function W(e){return H.apply(this,arguments)}function H(){return(H=(0,s.Z)(i().mark((function e(t){var n,r,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.action,e.next=3,I();case 3:a=e.sent,s=a.getState(),e.t0=n,e.next=e.t0===g.WQ?8:e.t0===g.PG?10:e.t0===g.S$?12:e.t0===g.IR?14:e.t0===g.rV?16:18;break;case 8:return c=ne,e.abrupt("break",20);case 10:return c=$,e.abrupt("break",20);case 12:return c=ee,e.abrupt("break",20);case 14:return c=V,e.abrupt("break",20);case 16:return c=le,e.abrupt("break",20);case 18:return c=X,e.abrupt("break",20);case 20:return e.abrupt("return",k.Z[n](r,s,{update:c}));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,n,r){return K.apply(this,arguments)}function K(){return(K=(0,s.Z)(i().mark((function e(t,n,r,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.id){e.next=5;break}return e.next=3,pe(t,n,r,a);case 3:return e.next=5,ue(t,n,r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return J.apply(this,arguments)}function J(){return(J=(0,s.Z)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:r=e.sent,t?t.status&&409===t.status?r.dispatch(h.updateAccountFailureDupEmail()):t.status&&t.status>=400&&t.status<500?r.dispatch(h.updateAccountFailurePassword()):r.dispatch(h.updateAccountFailure()):r.dispatch(h.updateAccountSuccess(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,s.Z)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:r=e.sent,t?t.status&&r.dispatch(h.deleteAccountFailure()):(r.dispatch(h.logout()),r.dispatch(h.deleteAccountFlag(!0)));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=(0,s.Z)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:if((r=e.sent).getState()){e.next=5;break}return e.abrupt("return");case 5:t?r.dispatch(h.changePasswordFailure()):r.dispatch(h.changePasswordSuccess());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=(0,s.Z)(i().mark((function e(t){var n,r,s,c,u,p,d,l,f,y,g,v;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:if(n=e.sent,t){e.next=6;break}throw n.dispatch(h.updateStateStatus(x.re.an)),new Error("Response error.");case 6:if(r=t,!O||O!==r){e.next=11;break}return n.dispatch(h.updateStateStatus(x.re.MR)),(0,b.Bl)(h,n),e.abrupt("return");case 11:s=o(t),c=n.getState(),Object.keys(s.config).length||(console.warn("Sync: No version on server yet."),j(!1),n.dispatch(h.changeConfig("user",c.config.user))),O?(console.warn("Sync: all synced!"),n.dispatch(h.updateAllLists(s.lists)),n.dispatch(h.updateAllLabels(s.labels)),n.dispatch(h.updateAllTeams(s.teams)),n.dispatch(h.updateAllGroups(s.groups)),s.config&&!0===s.config.seenOnboarding?s.config.seenOnboarding=(0,a.Z)(P):s.config&&!1===s.config.seenOnboarding&&(s.config.seenOnboarding=[]),n.dispatch(h.updateConfig(Object.assign({},s.config,{user:c.config.user}))),n.dispatch(h.updateStateStatus(x.re.MR)),(0,b.Bl)(h,n),j(r)):(console.warn("Sync: update server."),d=!s.teams.length,l=null==s||null===(u=s.teams)||void 0===u||null===(p=u[0])||void 0===p?void 0:p.id,d&&(f="".concat(c.config.user.name,"'s organization"),y=n.dispatch(h.addTeam(f)),l=null==y?void 0:y.teamId),g=c.labels.labels.filter((function(e){return!Object.prototype.hasOwnProperty.call(e,"version")})),v=Object.values(c.lists).filter((function(e){return!Object.prototype.hasOwnProperty.call(e,"version")})),g.forEach((function(e){return n.dispatch(h.addLabel(e.title,e.color,e.id))})),v.forEach((function(e){var t=e.cards.map((function(e){return Object.assign({},e)}));n.dispatch(h.addList({teamId:l,title:e.title,cards:t,listId:e.id,expanded:e.expanded})),Number.isInteger(e.col)&&n.dispatch(h.editListColumn(e.id,e.col)),e.labelIds.forEach((function(t){return n.dispatch(h.addListLabel(e.id,t))}))})),n.dispatch(h.selectTeam(l)),j("to-update"),A(!0),console.info("getting latest state from server..."),n.dispatch(h.getState()));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){return se.apply(this,arguments)}function se(){return(se=(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:e.sent.dispatch(h.pendingReqEmpty()),j(!1),(0,l.co)("showAnnouncementBanner",!0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(){return ie.apply(this,arguments)}function ie(){return(ie=(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:e.sent.dispatch(h.logout()),ae();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e,t,n){return oe.apply(this,arguments)}function oe(){return(oe=(0,s.Z)(i().mark((function e(t,n,r){var a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.id,s=r.version,t&&n&&a&&s){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,I();case 6:c=e.sent,y.zG.items(c.getState()).forEach((function(e){var r=e.req;"list"===t&&r.action.type===g.q1&&r.action.lists[n]&&(r.action.lists[a]=R({},r.action.lists[n]),delete r.action.lists[n]),r.action["".concat(t,"Id")]===n&&(r.action["".concat(t,"Id")]=a)}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,t,n,r){return de.apply(this,arguments)}function de(){return(de=(0,s.Z)(i().mark((function e(t,n,r,a){var s,c,u,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.id,c=r.version,t&&n&&s&&c){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,I();case 6:u=e.sent,e.t0=t,e.next="list"===e.t0?10:"card"===e.t0?15:"group"===e.t0?17:"team"===e.t0?19:"label"===e.t0?22:24;break;case 10:return o=u.getState(),y.TN.selectRecentListSaveSessionId(o)[n]&&u.dispatch(h.updateRecentPopupSaveSessionListsId({oldListId:n,newListId:s})),u.dispatch(h.updateList(n,R(R({},r),{},{id:s,version:c}))),e.abrupt("break",26);case 15:return u.dispatch(h.updateCard(r.listId,n,{id:s,version:c})),e.abrupt("break",26);case 17:return u.dispatch(h.updateGroup(n,r)),e.abrupt("break",26);case 19:return u.dispatch(h.updateTeam(n,r)),a&&a.selectTeam&&h.selectTeam(a.selectTeam)(u.dispatch),e.abrupt("break",26);case 22:return u.dispatch(h.updateLabel(n,{id:s,version:c})),e.abrupt("break",26);case 24:return console.log("ERROR: Action on corresponding resource ".concat(t)),e.abrupt("break",26);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,t){return fe.apply(this,arguments)}function fe(){return(fe=(0,s.Z)(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:e.sent.dispatch(h.updateTobyLinks(t.data,n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(){return be.apply(this,arguments)}function be(){return(be=(0,s.Z)(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:t=e.sent,n=navigator.onLine,y.Z8.internet(t.getState())!==n&&(n?(console.info("NETWORK: ONLINE"),t.dispatch(h.pendingReqResetTimeAndCountHead()),t.dispatch(h.getState())):n||console.info("NETWORK: OFFLINE"),t.dispatch(h.internetStatus(n)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ye=(0,d.debounce)(ne,5e3,{maxWait:1e4,leading:!0});function ge(){return(ge=(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:e.sent.dispatch(h.pendingReqResetTimeAndCountHead());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}window.addEventListener("online",he),window.addEventListener("offline",he),window.setInterval(he,3e3),window.killRequests=ae,window.pendingReqReset=function(){return ge.apply(this,arguments)},window.getStore=I}}]);